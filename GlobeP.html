<!DOCTYPE html>
<head>
    <title>Globe</title>
    <script src="https://d3js.org/d3-dispatch.v2.min.js"></script>
    <script src="https://d3js.org/d3-selection.v2.min.js"></script>
    <script src="https://d3js.org/d3-drag.v2.min.js"></script>

    <style>
        body {
          font-family: "Helvetica Neue", Helvetica, sans-serif;
          font-size: 14px;
          color: #333;
        }
        

        .graticule {
            fill:none;
            stroke:black;

        }
        .info {
            height : 50px;
            font-size: 45px;
            text-align: center;
        }
        div#Globe g.map {
                text-align:"center";
        }


        </style>
</head>

<body>

    <div id="Globe" align="center">
        <svg width="900px" height="650px" id = "t">
          <g class="map"></g>
        </svg>
      </div>
        <div class="info"  >       Hover over a country</div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.2.2/d3.min.js"></script>
    <script>

        //Loading the orb
        var centerorb = [0,0];
        var {width, height} = d3.select("#Globe").node().getBoundingClientRect();
        var centerxy = d3.geoOrthographic()(centerorb);
        var svg = d3.select("#Globe g.map")
        svg.append("g")
        // var orb = svg.append("g")
        //     .attr("stroke","black");

        var projection = d3.geoOrthographic()
            .scale(250)
            .precision(0.5)
            .center(centerorb);

        
        var geoGenerator = d3.geoPath()
            .projection(projection);
        function update(datafile){
            var u = d3.select("#Globe g.map")    
                .selectAll("path")
                .data(datafile.features)
            u.enter()
                .append('path')
                .attr("d",geoGenerator)
                .attr("fill","green")
                .attr("stroke","black")
                .on("mouseover", function(p){
                    if(!mouseDown){
                    d3.select(this).attr("opacity", 0.5)
                    d3.select(".info")
                        .text(p.properties.name);
                }})
                .on("mouseout",function(){
                    if(!mouseDown){
                    d3.select(this).attr("opacity",1)
                    d3.select(".info")
                        .text("                      Hover over a country")
                        .style("font-size","45px")
                        .style("text-align","center")
                }})

                // .on("mouseleave",handleMouseoff);
                
        }

        d3.json("/world.json", function(err,json) {update(json)})
        svg.append("circle")
            .attr("cx",centerxy[0])
            .attr("cy",centerxy[1])
            .attr("r",250)
            .attr("fill","blue")
            .attr("stroke","black");
        // var graticule = d3.geoGraticule();
        // console.log(graticule());
        // orb.append("path")
        //     .datum(graticule)
        //     .attr("class", "graticule")
        //     .attr("d", path)

        ////////////////////////
        //Dragging the orb
        var mouseDown = false;
        // var graticule = d3.geoGraticule();
        //             orb.append("path")
        //                 .datum(graticule)
        //                 .attr("class", "graticule")
        //                 .attr("d", path)
        // svg.call(d3.drag()
        //     .on("start",function(){
        //         mouseDown = true
        //     })
        //     .on("drag",function() {
        //         const rot = projection.rotate()
        //         projection.rotate([rot[0]+d3.event.sourceEvent.movementX*0.7, rot[1]-d3.event.sourceEvent.movementY*0.7]);
        //         //Update the orb
        //         path = d3.geoPath().projection(projection)
        //         svg.selectAll("path").attr("d", path)
        //         //orb.selectAll("path").attr("d",path)

        //     })
        //     .on("end",function(){
        //         mouseDown = false
        //     }))
            function dragSubject(){
            var r= projection.rotate();
        return {
            x: r[0], y:-r[1]
        };
        }
        var panner = d3.drag()
            .subject(dragSubject)
            .on("drag",function() {
                projection.rotate([projection.rotate()[0]+d3.event.dx, projection.rotate()[1]-d3.event.y]);
                //Update the orb
                svg.selectAll("path").attr("d",path);
            })
        svg.call(panner);

        document.getElementById
    </script>
</body>