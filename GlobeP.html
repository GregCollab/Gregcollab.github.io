<!DOCTYPE html>
<head>
    <title>Globe</title>
    <script src="https://d3js.org/d3-dispatch.v2.min.js"></script>
    <script src="https://d3js.org/d3-selection.v2.min.js"></script>
    <script src="https://d3js.org/d3-drag.v2.min.js"></script>

    <style>
        body {
          font-family: "Helvetica Neue", Helvetica, sans-serif;
          font-size: 14px;
          color: #333;
        }
        

        .graticule {
            fill:white;
            stroke:black;
        }
        </style>
</head>

<body>
    <div id="Globe">
        <svg width="900px" height="650px">
          <g class="map"></g>
        </svg>
      </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.2.2/d3.min.js"></script>
    <script>
        //Loading the orb
        var centerorb = [0,0];
        var {width, height} = d3.select("#Globe").node().getBoundingClientRect();
        var centerxy = d3.geoOrthographic()(centerorb);
        var svg = d3.select("#Globe g.map")
        svg.append("rect")
            .attr("width",900)
            .attr("height", 650)
            .attr("fill","grey")
        var orb = svg.append("g")
		    //.attr("transform", "translate(" + margin.left + "," + margin.top + ")")
            .attr("fill","grey")
            .attr("stroke","black");

        var projection = d3.geoOrthographic()
            .scale(250)
            .center(centerorb);
        
        d3.json("/world.json", function(data){
        var geoGenerator = d3.geoPath()
            .projection(projection);
        svg.selectAll('path')
            .data(data.features)
            .enter()
            .append('path')
            .attr('d',geoGenerator);
        });
        orb.append("circle")
            .attr("cx",centerxy[0])
            .attr("cy",centerxy[1])
            .attr("r",250)
            .attr("fill","white")
            .attr("stroke","black");
        var path = d3.geoPath()
            .projection(projection);
        var graticule = d3.geoGraticule();
        console.log(graticule());
        svg.append("path")
            .datum(graticule)
            .attr("class", "graticule")
            .attr("d", path)

        ////////////////////////
        //Dragging the orb
        function dragSubject(){
            var r= projection.rotate();
        return {
            x: r[0], y:-r[1]
        };
        }
        var panner = d3.drag()
            .subject(dragSubject)
            .on("drag",function() {
                projection.rotate([projection.rotate()[0]*0.5+d3.event.x*0.05, -projection.rotate()[1]*0.5-d3.event.y*0.05]);
                //Update the orb
                svg.selectAll("path").attr("d",path);
            })
        svg.call(panner);
    </script>
</body>